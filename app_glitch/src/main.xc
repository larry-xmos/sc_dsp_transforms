// Copyright (c) 2011, XMOS Ltd, All rights reserved
// This software is freely distributable under a derivative of the
// University of Illinois/NCSA Open Source License posted in
// LICENSE.txt and at <http://github.xcore.com/>

#include "stdio.h"
#include "fft.h"
#include "kaiser.h"
#include "hann.h"

int glitch[1024] = {
-22015360, -18814016, -15273920, -11477376, -7487872, -3376192, 789696, 4960128, 9036288, 
12959232, 16662976, 20084608, 23156352, 25842816, 28089152, 29840640, 31088896, 
31800256, 31970176, 31603584, 30701376, 29251008, 27325888, 24921664, 22090944, 
18881856, 15353664, 11560320, 7572800, 3459712, -717888, -4883776, -8951104, -12883328, -16584768, -20003200, -23089472, -25768832, -27999168, -29754496, -31004096, 
-31720832, -31904832, -31530816, -30616064, -29175552, -27242048, -24844352, -22018944, 
-18803520, -15270208, -11479424, -7493120, -3380864, 791040, 4949760, 9036544, 
12957184, 16664064, 20082496, 23160960, 25840448, 28075392, 29832448, 31084416, 31804352, 31980416, 31607232, 30699136, 29255296, 27327936, 24919424, 22076288, 
18879104, 15352128, 11566208, 7577920, 3458944, -718336, -4877440, -8955648, 
-12888704, -16582272, -20006912, -23083840, -25753920, -27991552, -29753984, -31001728, 
-31725504, -31897728, -31528064, -30618496, -29181376, -27247616, -24835072, -22003904, -18798976, -15275136, -11489344, -7495552, -3383552, 791744, 4954112, 9033472, 
12967616, 16670400, 20081728, 23153408, 25837248, 28074432, 29830208, 31080896, 
31800832, 31979968, 31609216, 30703744, 29256064, 27318912, 24911808, 22086016, 
18872896, 15353024, 11556992, 7574656, 3458240, -716672, -4881216, -8960896, -12890368, -16585792, -20000640, -23079488, -25759552, -27995136, -29760896, -31005632, 
-31734272, -31913216, -31533824, -30618688, -29177792, -27235008, -24834112, -22013184, 
-18806720, -15272832, -11490112, -7496832, -3382144, 801152, 4960128, 9038912, 
12957696, 16661248, 20081152, 23161856, 25832704, 28079424, 29835328, 31092544, 31803904, 31982912, 31607744, 30695424, 29252032, 27315200, 24912640, 22081344, 
18886400, 15356288, 11570944, 7577472, 3454080, -722432, -4883328, -8957504, 
-12887104, -16585984, -20001728, -23080192, -25761408, -27999424, -29762944, -31011840, 
-31732992, -31903232, -31523584, -30612096, -29171136, -27234944, -24840832, -22015424, -18811968, -15279488, -11489536, -7490368, -3380288, 796736, 4954304, 9035904, 
12963456, 16662976, 20083072, 23158464, 25840640, 28079104, 29836032, 31089664, 
31803008, 31975616, 31598912, 30687424, 29252544, 27325504, 24915648, 22102016, 
18886400, 15356864, 11565120, 7567488, 3448768, -720000, -4883584, -8952512, -12882304, -16584256, -19995264, -23075264, -25771776, -28006272, -29766080, -31013248, 
-31727936, -31902208, -31519168, -30616192, -29180288, -27237120, -24839616, -22018560, 
-18811136, -15278976, -11480448, -7496896, -3365952, 792960, 4957504, 9039296, 
12955584, 16660288, 20079296, 23152960, 25840448, 28087552, 29835008, 31082176, 31803136, 31966464, 31604672, 30684736, 29252608, 27322112, 24922816, 22087168, 
18879040, 15348096, 11559808, 7571840, 3449408, -718656, -4882944, -8950464, 
-12885312, -16586240, -20010752, -23089472, -25770432, -27999744, -29758848, -31011328, 
-31722624, -31898752, -31532352, -30614208, -29183104, -27245056, -24844224, -22013120, -18802944, -15274112, -11478528, -7491520, -3383872, 793856, 4951296, 9031552, 
12953728, 16676224, 20083008, 23161152, 25838144, 28081344, 29834752, 31084416, 
31809472, 31981632, 31600064, 30701376, 29258304, 27317952, 24917760, 22084544, 
18876672, 15350912, 11554752, 7575040, 3455552, -713664, -4875584, -8963072, -12889536, -16588992, -20003904, -23082944, -25762624, -27997568, -29752192, -31005952, 
-31725568, -31902016, -31532352, -30619968, -29183104, -27245440, -24841792, -22009152, 
-18805632, -15275072, -11482432, -7502144, -3377088, 788608, 4955264, 9036800, 
12965632, 16671168, 20085312, 23150848, 25836352, 28075712, 29832576, 31088128, 31798848, 31984576, 31613376, 30698176, 29255808, 27319680, 24915136, 22081536, 
18872128, 15355264, 11560384, 7586240, 3459200, -721088, -4877248, -8956608, 
-12884288, -16582656, -20007680, -23079168, -25755072, -27992320, -29753088, -31004864, 
-31729536, -31910592, -31533184, -30607040, -29172608, -27234304, -24833152, -22011200, -18800704, -15274752, -11487552, -7502080, -3382400, 796544, 4960640, 9042752, 
12960896, 16665984, 20081152, 23158976, 25838720, 28074048, 29836096, 31094336, 
31801792, 31974272, 31610816, 30695488, 29258752, 27325120, 24916672, 22085376, 
18888064, 15362368, 11573888, 7582720, 3456256, -717952, -4877760, -8963712, -12886912, -16580096, -20006144, -23075520, -25756160, -27993600, -29765632, -31005952, 
-31725184, -31908160, -31530368, -30611776, -29170816, -27240192, -24840704, -22013120, 
-18812160, -15280768, -11494464, -7489088, -3377472, 796032, 4962560, 9039872, 
12963520, 16664000, 20081856, 23148864, 25840256, 28078272, 29835776, 31092288, 31802368, 31974656, 31606656, 30690496, 29251776, 27317632, 24916416, 22099584, 
18887680, 15358528, 11556608, 7577216, 3454336, -720896, -4882240, -8961472, 
-12881088, -16579840, -19999168, -23082368, -25769792, -27995968, -29765056, -31008384, 
-31727552, -31907648, -31529344, -30607744, -29179072, -27245056, -24847936, -22018176, -18813888, -15273344, -11480064, -7494656, -3372416, 791936, 4957632, 9038016, 
12952256, 16664384, 20077440, 23155904, 25846208, 28079040, 29837440, 31096896, 
31799936, 31979392, 31604352, 30694784, 29256896, 27324544, 24922816, 22089408, 
18882240, 15355520, 11562112, 7575232, 3450432, -716800, -4877568, -8951872, -12876864, -16579136, -19996864, -23085888, -25759616, -27998848, -29759808, -31000704, 
-31724288, -31897280, -31524800, -30620288, -29181568, -27241664, -24841600, -22011712, 
-18806784, -15269504, -11483712, -7486464, -3381056, 786112, 4952832, 9039360, 
12962240, 16672576, 20087808, 23159424, 25837952, 28085120, 29836992, 31082176, 31804224, 31977792, 31613568, 30706432, 29265088, 27330688, 24920768, 22095360, 
18881984, 15354816, 11564544, 7577152, 3466112, -712192, -4876224, -8948928, 
-12883776, -16581632, -20007296, -23080576, -25760576, -27996224, -29750272, -31008640, 
-31723008, -31895744, -31530624, -30613120, -29182336, -27239168, -24838464, -22011584, -18798080, -15267072, -11480832, -7505280, -3387136, 799552, 4955328, 9036288, 
12959488, 16661504, 20094464, 23160832, 25843840, 28073664, 29828608, 31078848, 
31803264, 31982208, 31609920, 30697024, 29262592, 27328960, 24921664, 22085952, 
18871936, 15353280, 11568128, 7583744, 3462272, -719424, -4882112, -8951104, -12885888, -16581696, -20013888, -23081408, -25757312, -27987072, -29750720, -31003008, 
-31725632, -31899776, -31529280, -30617216, -29184000, -27239616, -24827072, -22010560, 
-18803264, -15279872, -11483776, -7502208, -3378176, 796288, 4955584, 9042496, 
12968000, 16675904, 20084864, 23158464, 25836160, 28086336, 29834240, 31091136, 31810816, 31982656, 31612288, 30694464, 29262336, 27325312, 24924096, 22086208, 
18886144, 15354816, 11571584, 7580416, 3462912, -716032, -4884928, -8956352, 
-12889600, -16580992, -19999296, -23071488, -25759360, -27993024, -29760128, -30999104, 
-31726976, -31906176, -31521344, -30607872, -29169472, -27231808, -24832128, -22008832, -18810048, -15276608, -11478784, -7489920, -3377856, 800384, 4974912, 9048512, 
12958720, 16667712, 20083776, 23149696, 25841024, 28086464, 29908032, 31407744, 
32178304, 31693696, 31648896, 30669376, 29116480, 20652416, 4415168, 21394432, 
24879104, 9252352, 16662528, 3882496, 5622848, -2595712, -3887104, -9209536, -13128064, -15899520, -20945024, -21915392, -27033920, -26610624, -31169088, -29564096, 
-33136640, -30486016, -32869696, -29278848, -30418304, -26026496, -25962304, -20917312, 
-19811904, -14300608, -12375296, -6620032, -4159552, 1573760, 4264832, 9721664, 
12349312, 17266624, 19549120, 23687680, 25374272, 28556160, 29428288, 31508544, 31439232, 32347008, 31284800, 31025472, 28975936, 27625024, 24671040, 22354048, 
18663744, 15599744, 11358528, 7793792, 3278976, -515648, -5038144, -8774080, 
-13018176, -16415232, -20125504, -22935232, -25877184, -27863360, -29861120, -30881216, 
-31808768, -31778240, -31609408, -30502528, -29249984, -27140352, -24906048, -21925056, -18862272, -15183040, -11529664, -7405568, -3423168, 874368, 4916736, 9102464, 
12920704, 16737408, 20054912, 23220544, 25814592, 28136192, 29808512, 31148992, 
31786880, 32029760, 31578432, 30746688, 29244416, 27385152, 24903168, 22131840, 
18870528, 15391936, 11545984, 7619264, 3449280, -680384, -4881216, -8913920, -12879232, -16554240, -20010304, -23058432, -25767040, -27965504, -29756224, -30971520, 
-31715904, -31873344, -31521088, -30587392, -29179776, -27212480, -24832768, -21987520, 
-18790464, -15243904, -11476480, -7465216, -3374784, 811584, 4966144, 9063872, 
12970560, 16690688, 20099776, 23183872, 25849152, 28095808, 29837376, 31110080, 31813056, 32000640, 31622784, 30723776, 29268928, 27349248, 24925824, 22106304, 
18889792, 15374272, 11579008, 7606656, 3479680, -692928, -4862976, -8937856, 
-12873472, -16570688, -19993536, -23067520, -25744768, -27974784, -29750016, -30975808, 
-31714304, -31881216, -31520320, -30602688, -29170560, -27213632, -24823808, -21989440, -18792832, -15256704, -11478080, -7480640, -3364992, 810560, 4973696, 9063232, 
12979200, 16689984, 20100416, 23171264, 25855552, 28097344, 29851328, 31105856, 
31827712, 31999040, 31624768, 30718272, 29274944, 27330752, 24928320, 22099008, 
18900672, 15375872, 11581568, 7600832, 3474944, -704128, -4865728, -8946304, -12868864, -16563712, -19989440, -23065792, -25735744, -27982336, -29750272, -30990784, 
-31711104, -31887296, -31516992, -30603136, -29160832, -27222528, -24818816, -21997120, 
-18795072, -15261440, -11471744, -7477312, -3367680, 808384, 4978880, 9055552, 
12980224, 16681472, 20093568, 23173760, 25846016, 28101888, 29853248, 31110208, 31821312, 31986240, 31617152, 30710912, 29266368, 27335552, 24927296, 22102592, 
18898752, 15380224, 11578048, 7595456, 3473152, -705152, -4865536, -8946496, 
-12865088, -16565312, -19982528, -23060224, -25736640, -27980032, -29746304, -30988800, 
-31715072, -31887360, -31507968, -30597504, -29155584, -27215424, -24822528, -22003072, -18784320, -15258240, -11474176, -7475392, -3359936, 816192, 4972544, 9060032, 
12976448, 16683584, 20092992, 23173952, 25862784, 28097344, 29848256, 31106624, 
31819904, 31984448, 31623040, 30712576, 29273984, 27343680, 24937920, 22105728, 
18899584, 15368384, 11578496, 7590528, 3471424, -702656, -4856832, -8935424, -12858368, -16563712, -19982912, -23068288, -25749824, -27982528, -29740544, -30983360, 
-31708416, -31884416, -31509376, -30597568, -29167744, -27229632, -24829632, -22003520, 
-18791744, -15259136, -11467264, -7473408, -3367680, 814272, 4969856, 9050368, 
12971008, 16687360, 20098240, 23176384, 25861184, 28096768, 29848128, 
};

int signal[1024] = {
-25905407, -23502335, -20661887, -17461759, -13920895, -10147711, -6138367, -2020863, 2157056, 
6320384, 10402304, 14305280, 18012928, 21426176, 24508672, 27184640, 29431552, 
31179136, 32421248, 33170432, 33333377, 32942977, 32022657, 30604161, 28654721, 
26271233, 23444353, 20241409, 16712065, 12899457, 8920065, 4799489, 619904, -3515392, -7597952, -11529344, -15234048, -18661632, -21737344, -24420992, -26654208, 
-28434944, -29668736, -30378112, -30552063, -30172159, -29264767, -27848703, -25908223, 
-23500287, -20673279, -17458303, -13924351, -10133247, -6137599, -2021631, 2149632, 
6308992, 10387328, 14312832, 18006912, 21438848, 24515456, 27187456, 29423360, 31184384, 32411264, 33136256, 33314561, 32929153, 32034689, 30602497, 28678785, 
26264833, 23452033, 20228097, 16693377, 12902401, 8923265, 4798721, 647040, 
-3513216, -7591680, -11532160, -15231232, -18651264, -21752960, -24425344, -26653312, 
-28419456, -29659648, -30394496, -30559487, -30183935, -29273087, -27856639, -25919231, -23497727, -20668031, -17459455, -13910399, -10135551, -6149247, -2025471, 2148352, 
6313856, 10391168, 14311808, 18019456, 21440384, 24512768, 27195648, 29424896, 
31158656, 32416512, 33133184, 33303169, 32943873, 32038913, 30583809, 28668161, 
26261121, 23425921, 20235137, 16688257, 12904705, 8927745, 4822785, 638336, -3523200, -7579520, -11532544, -15250816, -18669056, -21747328, -24418432, -26640128, 
-28412416, -29658496, -30384256, -30569599, -30190079, -29281151, -27850879, -25908223, 
-23494399, -20648831, -17443199, -13918719, -10137855, -6158335, -2028799, 2141440, 
6310912, 10385152, 14314496, 18024064, 21455232, 24517760, 27185024, 29416320, 31161344, 32421248, 33145728, 33319681, 32959105, 32053505, 30598017, 28670977, 
26257409, 23425153, 20237569, 16708737, 12912513, 8928641, 4819073, 633984, 
-3525504, -7603584, -11547264, -15248128, -18654208, -21734272, -24410112, -26639104, 
-28415104, -29656448, -30400384, -30573439, -30197759, -29272575, -27825535, -25888511, -23478271, -20672895, -17452799, -13925759, -10147711, -6155263, -2031743, 2159488, 
6322560, 10404736, 14323456, 18015872, 21434240, 24502272, 27178240, 29408768, 
31175040, 32438528, 33164800, 33332865, 32958465, 32036993, 30583809, 28659585, 
26257665, 23432449, 20243457, 16724097, 12916993, 8929025, 4814977, 637184, -3530368, -7606656, -11540096, -15231232, -18655744, -21729152, -24404224, -26646528, 
-28436608, -29684992, -30385024, -30567295, -30197759, -29263231, -27835903, -25900543, 
-23494143, -20666495, -17456639, -13932671, -10150911, -6146175, -2023935, 2160256, 
6318720, 10398848, 14296960, 18020352, 21437184, 24509056, 27190528, 29412096, 31189248, 32446464, 33147776, 33313409, 32935425, 32028673, 30584193, 28657665, 
26272513, 23446529, 20242433, 16722305, 12916609, 8916481, 4800513, 624128, 
-3546496, -7583744, -11541760, -15224576, -18649600, -21725312, -24411776, -26663040, 
-28433024, -29676416, -30386432, -30557055, -30176383, -29245951, -27840383, -25904255, -23502207, -20670463, -17461375, -13913855, -10128255, -6146303, -2013695, 2152448, 
6312704, 10399104, 14307584, 18008832, 21435904, 24502016, 27193728, 29429632, 
31172480, 32409344, 33149696, 33319809, 32932353, 32028673, 30594945, 28663809, 
26267009, 23440641, 20240385, 16702721, 12894465, 8918145, 4803713, 633856, -3512832, -7588480, -11530368, -15236992, -18659328, -21739136, -24435328, -26662144, 
-28425472, -29664000, -30385664, -30554239, -30167295, -29271295, -27858815, -25920383, 
-23500031, -20670207, -17454591, -13911423, -10143999, -6147327, -2020479, 2147072, 
6308352, 10386304, 14296576, 18011264, 21438208, 24513536, 27194240, 29427328, 31164416, 32428800, 33145472, 33323137, 32953601, 32042625, 30614913, 28678529, 
26270977, 23437569, 20224129, 16689537, 12901249, 8926081, 4809985, 645504, 
-3501696, -7599104, -11534464, -15244800, -18665728, -21736448, -24420992, -26655232, 
-28419200, -29674368, -30389888, -30570495, -30189439, -29277823, -27869823, -25912575, -23495551, -20655487, -17467007, -13917311, -10146175, -6146303, -2034559, 2139392, 
6312576, 10390784, 14316160, 18018560, 21447168, 24501248, 27175552, 29415808, 
31165568, 32411136, 33139968, 33322625, 32946689, 32039937, 30595073, 28658177, 
26259457, 23418497, 20228609, 16695937, 12912257, 8927489, 4818689, 628864, -3521792, -7604864, -11549312, -15246848, -18673664, -21732352, -24416128, -26651008, 
-28413568, -29678336, -30402304, -30577151, -30198783, -29272831, -27845887, -25895551, 
-23489535, -20654719, -17447423, -13941375, -10145919, -6166143, -2034559, 2140800, 
6308992, 10407936, 14313856, 18012800, 21426432, 24511872, 27174528, 29416192, 31164288, 32428160, 33147520, 33317633, 32950785, 32027905, 30579713, 28651777, 
26256257, 23425921, 20242177, 16704513, 12919681, 8929921, 4804993, 636288, 
-3524096, -7624448, -11536768, -15238784, -18655232, -21717632, -24409600, -26653056, 
-28426624, -29682048, -30389504, -30572415, -30190335, -29276415, -27851647, -25895551, -23491327, -20675711, -17482623, -13942911, -10150655, -6143871, -2014847, 2151424, 
6317312, 10405504, 14294144, 18013184, 21425536, 24488448, 27185664, 29426816, 
31168128, 32419200, 33141120, 33314561, 32943233, 32023425, 30586113, 28646785, 
26257153, 23437057, 20234241, 16713601, 12906113, 8926977, 4798593, 619776, -3533952, -7606656, -11539072, -15229056, -18638720, -21737984, -24429312, -26673280, 
-28445824, -29672320, -30395776, -30566271, -30188671, -29274239, -27856383, -25920383, 
-23512319, -20676991, -17474047, -13925631, -10120319, -6143615, -2044799, 2156288, 
6313472, 10384128, 14293760, 18004224, 21419776, 24518784, 27193344, 29425408, 31189888, 32423552, 33137792, 33314049, 32930433, 32039297, 30594945, 28675969, 
26256641, 23427329, 20224769, 16702337, 12892673, 8912897, 4804097, 637440, 
-3522560, -7594240, -11527680, -15237632, -18658304, -21751296, -24431872, -26653312, 
-28421248, -29669376, -30384896, -30563199, -30187519, -29287807, -27843071, -25903487, -23511039, -20668543, -17453439, -13923071, -10121087, -6130431, -2027007, 2148736, 
6296960, 10386688, 14310016, 18013696, 21428608, 24509952, 27190656, 29421184, 
31180288, 32428416, 33124480, 33324673, 32945793, 32046209, 30597633, 28675329, 
26248449, 23420289, 20227201, 16692481, 12896257, 8919169, 4818689, 634496, -3515392, -7595264, -11537152, -15254784, -18667136, -21736448, -24417280, -26652544, 
-28421120, -29656448, -30368640, -30567679, -30197631, -29303551, -27850495, -25904255, 
-23496575, -20671743, -17447423, -13921407, -10139647, -6148479, -2037119, 2133120, 
6313472, 10383488, 14310656, 18013952, 21432704, 24510720, 27172992, 29412480, 31170944, 32409856, 33131392, 33303425, 32946305, 32045953, 30603009, 28651777, 
26265217, 23407617, 20217729, 16700161, 12922625, 8932097, 4829057, 642816, 
-3516800, -7597568, -11539968, -15250816, -18650112, -21739392, -24432768, -26639104, 
-28433536, -29673344, -30394624, -30565247, -30206847, -29279999, -27840383, -25907583, -23493119, -20641663, -17455359, -13916799, -10155775, -6141055, -2046847, 2145024, 
6306816, 10393088, 14306176, 18018176, 21433728, 24504960, 27168128, 29403520, 
31164288, 32417792, 33144704, 33304193, 32963969, 32047745, 30587905, 28645761, 
26242305, 23429889, 20243457, 16721665, 12910721, 8923393, 4806529, 619904, -3530752, -7611392, -11551104, -15232512, -18650240, -21724800, -24409088, -26655232, 
-28442368, -29682816, -30390144, -30560255, -30183807, -29271807, -27831167, -25884543, 
-23483903, -20662015, -17444991, -13934335, -10152703, -6154495, -2028415, 2169728, 
6321408, 10398848, 14300416, 18009216, 21422208, 24488960, 27181312, 29425920, 31172480, 32427648, 33153280, 33318273, 32935809, 32023041, 30576897, 28655745, 
26257793, 23434113, 20238593, 16700417, 12905473, 8929281, 4798465, 630016, 
-3535744, -7586048, -11535616, -15230464, -18651776, -21745920, -24407680, -26656512, 
-28425984, -29682432, -30387328, -30564863, -30180351, -29268991, -27849471, -25918463, -23499135, -20667775, -17466751, -13923071, -10139519, -6141311, -2015359, 2163456, 
6304640, 10390784, 14304896, 18003968, 21422592, 24515712, 27184512, 29437824, 
31168896, 32428928, 33139328, 33299073, 32935041, 32033665, 30588801, 28652929, 
26287617, 23428737, 20234113, 16708737, 12902401, 8915585, 4816513, 629248, -3520256, -7585920, -11536128, -15246336, -18663296, -21735168, -24419584, -26659200, 
-28430464, -29687296, -30384000, -30564607, -30187903, -29269247, -27844863, -25919103, 
-23513343, -20674943, -17459455, -13916031, -10137215, -6133503, -2032895, 2141440, 
6295552, 10377984, 14302720, 18018304, 21439488, 24513280, 27190272, 29426048, 31161216, 32420096, 33128064, 33302529, 32932097, 32047489, 30595073, 28673921, 
26260225, 23429377, 20227585, 16691969, 12901377, 8909697, 4818049, 632832, 
-3523072, -7593984, -11540864, -15246592, -18672128, -21744768, -24430080, -26665600, 
-28425984, -29674496, -30380544, -30557311, -30201087, -29285375, -27868415, -25912703, -23506815, -20655231, -17457663, -13904895, -10148607, -6159999, -2034559, 2145792, 
6300800, 10381568, 14297344, 18007168, 21444736, 24514560, 27178368, 29406080, 
31155200, 32416512, 33132544, 33317505, 32946177, 32045697, 30581889, 28653313, 
26259841, 23426177, 20211457, 16697857, 12903937, 8917761, 4804993, 637056, -3536000, -7612160, -11557376, -15257600, -18663808, -21743616, -24420608, -26655232, 
-28428928, -29679488, -30395904, -30570111, -30194303, -29282687, -27856511, -25899647, 
-23490303, -20661759, -17456383, -13928575, -10151039, -6154111, -2025215, 2146176, 
6315392, 10408064, 14304896, 18012160, 21424896, 24497536, 27169280, 29407616, 31156864, 32408960, 33136128, 33325057, 32952577, 32029825, 30583425, 28636545, 
26250625, 23417345, 20223233, 16711681, 12895489, 8914433, 4819073, 633856, 
-3551488, -7622784, -11553920, -15256832, -18648832, -21733248, -24422528, -26643072, 
-28442368, -29680640, -30412032, -30571135, -30208639, -29289599, -27844223, -25900927, -23510399, -20680191, -17470335, -13932031, -10149375, -6157567, -2015871, 2155136, 
6325504, 10387584, 14304896, 17995264, 21426816, 24481408, 27178368, 29418624, 
31170944, 32420480, 33140608, 33308929, 32941057, 32025089, 30578945, 28646017, 
26260225, 23438081, 20233729, 16699137, 12907009, 8916737, 4797825, 614528, -3548032, -7611264, -11545984, -15239680, -18662272, -21731584, -24412800, -26657920, 
-28436224, -29703040, -30409216, -30573823, -30189311, -29256447, -27855103, -25912959, 
-23505407, -20685567, -17458687, -13924479, -10142847, -6153343, -2015615, 2146176, 
6321664, 10374272, 14295936, 18008192, 21424896, 24497664, 27189504, 
};


void fftRealTest() {
    int re1[8] = {0, 1414000, 2000000, 1414000, 0, -1414000, -2000000, -1414000};
    int re2[8] = {0, 100000, 0, -1000000, 0, 100000, 0, -1000000};
    int im1[8], im2[8];
    int re3[8] = {0, 1414000, 2000000, 1414000, 0, -1414000, -2000000, -1414000};
    int re4[8] = {0, 100000, 0, -1000000, 0, 100000, 0, -1000000};
    int im3[8] = {0,0,0,0,0,0,0,0};
    int im4[8] = {0,0,0,0,0,0,0,0};
    timer t; int t0,t1;

    printf("FORWARDING\n");
    fftTwiddle(re3, im3, 8);
    fftForward(re3, im3, 8, FFT_SINE(8));
    fftTwiddle(re4, im4, 8);
    fftForward(re4, im4, 8, FFT_SINE(8));
t :> t0;
    fftTwoRealsForward(re1, re2, im1, im2, 8, FFT_SINE(8));
t :> t1;
    printf("Ticks: %d\n", t1-t0);
    for(int i = 0; i < 8; i++) {
        printf("%8d + %8d i = %8d + %8d i  ;  %8d + %8d i = %8d + %8d i\n",
               re1[i], im1[i], re3[i], im3[i],
               re2[i], im2[i], re4[i], im4[i]);
    }
    printf("INVERSING\n");
    fftTwiddle(re3, im3, 8);
    fftInverse(re3, im3, 8, FFT_SINE(8));
    fftTwiddle(re4, im4, 8);
    fftInverse(re4, im4, 8, FFT_SINE(8));
    fftTwoRealsInverse(re1, re2, im1, im2, 8, FFT_SINE(8));
    for(int i = 0; i < 8; i++) {
        printf("%8d + %8d i = %8d + %8d i  ;  %8d + %8d i = %8d + %8d i\n",
               re1[i], 0, re3[i], im3[i],
               re2[i], 0, re4[i], im4[i]);
    }

}



int sq(int x) {
    return x*x;
}

int mag(int x, int y) {
    long long r =  x * (long long) x + y * (long long) y;
    int res;
    asm("clz %0, %1" : "=r" (res) : "r" ((int)(r>>32)));
    if (res == 32) {
        asm("clz %0, %1" : "=r" (res) : "r" ((int)r));
        res += 32;
    }
    return 64-res;
}

//void window_kaiser(int output[], int data[], int offset, int N, const int hann[]) {
//int kaiser_half_40_32[16];

void fftTest1024(int in2[1024], int window) {
    int im[1024];
    int re[1024];
    for(int i = 0; i < 1024; i++) {
        im[i] = 0;
        re[i] = in2[i];
    }
    if (window == 1) {
        window_kaiser(re, in2, 0, 1024, kaiser_half_90_1024);
    } else if (window == 2) {
        window_kaiser(re, in2, 0, 1024, kaiser_half_120_1024);
    } else if (window == 3) {
        windowHann(re, in2, 0, 1024, sine_1024);
    }
    fftTwiddle(re, im, 1024);
    fftForward(re, im, 1024, FFT_SINE(1024));
    for(int i = 0; i < 512; i++) {
        printf("%d\n", mag(re[i], im[i]));
    }
}

int main(void) {
    fftTest1024(signal, 1);
    printf("\n");
    fftTest1024(signal, 2);
    printf("\n");
    fftTest1024(signal, 3);
    printf("\n");
    fftTest1024(glitch, 1);
    printf("\n");
    fftTest1024(glitch, 2);
    printf("\n");
    fftTest1024(glitch, 3);
    return 0;
}
